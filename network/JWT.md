## JWT 왜 필요한가 ?

이를 이해하기 위해 HTTP 특성과 쿠키 및 세션에 대해 먼저 알아보자.

### HTTP 특성

쿠키, 세션, 토큰이 등장하게 된 근본적인 배경에는 HTTP의 `Stateless`이 있다. 무상태성이라는 뜻으로 서버가 클라이언트의 상태를 보존하지 않음을 뜻한다. 무상태성의 장점은 서버의 부담을 줄여준다는 것이다. 하지만 이러한 특성으로 다음과 같은 문제점을 갖는다.

`웹페이지를 이용하는 사용자는 페이지를 이동할 때마다 로그인이 유지되지 않아 매번 로그인을 다시 해야 한다.`

이와 같은 문제점을 해결하기 위해 쿠키와 세션이라는 기술을 활용한다.

### 쿠키(**클라이언트쪽)

클라이언트의 정보를 로컬(브라우저)에 쿠키라는 파일 형태로 저장한다.

쿠키를 생성하는 방식을 조금 더 자세히 설명하면,

1. 클라이언트가 HTTP 요청을 서버로 보낸다.
2. 클라이언트의 응답에 따라 서버는 저장하고 싶은 정보를 응답헤더의 Set-Cookie에 담는다.
3. 이후 해당 클라이언트가 요청을 보낼 때마다 쿠키를 함께 넣어 보내고 서버는 그 정보를 바탕으로 해당 요청의 클라이언트를 식별한다.

하지만 쿠키는 용량에 제한이 있어 많은 정보를 담을 수 없고 쿠키의 사이즈가 커질수록 네트워크 부하가 심해진다. 또한 보안에 취약하다.

### 세션(**서버쪽)

이러한 보안적 이슈때문에 민감한 클라이언트의 정보를 브라우저가 아닌 서버측에 저장하고 관리한다. 서버의 메모리에 저장하기도 하고, 서버의 로컬 파일이나 데이터베이스에 저장하기도 한다.

Session의 동작 방식을 살펴보면,

1. 유저가 웹사이트에 로그인하면 세션이 서버 메모리 상에 저장된다. 이때 세션을 식별하기 위한 Session Id를 기준으로 정보를 저장한다.
2. 서버는 쿠키에 Session Id를 담아 클라이언트에 전송한다.
3. 클라이언트는 요청마다 쿠키에 Session Id를 담아 전송한다.

이러면 쿠키를 탈취당해도 Session Id만 탈취될뿐 정보는 서버에 저장되어있기 때문에 안전해졌다. 하지만 요청이 많아지면 문제가 될 수 있다. 서버 세션에 정보를 저장하는 경우 서버를 확장했을 때 세션 저장소를 찾기 위해 시간이 걸린다. 또한 데이터베이스에 세션 정보를 저장한다고 해도 요청이 많아질 경우 서버에 부하가 생긴다.

### 토큰

서버의 부하를 줄이기 위해, 서버에 정보를 저장하지 않고 암호화하여 사용하는 `토큰(Token)`이 등장했다. JWT(Json Web Token) 은 인증에 필요한 정보들을 Base64 URL-safe Encode를 통해 암호화하여 요청시 HTTP 헤더에 실어 전달한다.

JWT는 다음과 같이 세 부분으로 나뉘어져 있고 이를 Header, Payload, Signature라고 한다.

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ
.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

- Header : JWT 에서 사용할 타입과 해시 알고리즘의 종류가 담겨있다.
- Payload : 서버에서 첨부한 사용자 권한 정보와 데이터가 담겨있다.
    - Key-Value 형식으로 이루어진 한 쌍의 정보를 **Claim**이라고 한다.
- Signature : Header, Payload를 인코딩한 후 Header에 명시된 해시함수를 적용하고, 개인키로 서명한 전자서명이 담겨있다.

토큰 방식으로 인증 및 인가를 처리하고 있지만 가장 완벽한 방식은 아니다. 토큰의 Payload 자체는 암호화되지 않기 때문에 유저의 중요한 정보를 담을 수 없다. 또한 토큰은 한 번 발급되면 유효기간이 만료될 때까지 계속 사용이 가능하므로 탈취당하면 대처가 어렵다.

- 참고
    - https://velog.io/@bumsu0211/HTTP%EC%9D%98-%ED%8A%B9%EC%84%B1%EA%B3%BC-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0
    - https://velog.io/@whitebear/%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0JWT-%ED%99%95%EC%8B%A4%ED%9E%88-%EC%95%8C%EA%B3%A0-%EA%B0%80%EA%B8%B0